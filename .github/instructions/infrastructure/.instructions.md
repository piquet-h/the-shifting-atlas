---
description: Infrastructure delta instructions (Bicep authoring guardrails)
applyTo: 'infrastructure/**'
---

# Infrastructure instructions (Bicep)

These rules apply to anything under `infrastructure/`.

## Scope

- This folder provisions Azure resources using Bicep.
- Infra changes are high impact: keep diffs small, explain safety, and avoid renames.

## Authoring guardrails

- Prefer Azure Verified Modules (AVM) when adding new resource types.
- Never embed secrets in templates. Use Key Vault + Managed Identity wiring.
- Avoid hardcoding tenant/subscription-specific values.
- Keep deployments idempotent (re-deploy updates in place).

## Workbooks

- Parameters must be mirrored in both the workbook `parameters[]` and any `KqlParameterItem` controls.
- Guard KQL against blank strings / placeholder tokens before parsing.
- Provide deploy-time defaults for analytical thresholds.
- If baseline is missing, show info + null (do not fabricate metrics).

## Keep the README ensure-in-sync

If you add/remove parameters or outputs, update `infrastructure/README.md`.

---

Last reviewed: 2026-01-15
