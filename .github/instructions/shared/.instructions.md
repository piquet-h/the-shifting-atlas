---
description: Shared package delta instructions (contract, boundaries, versioning)
applyTo: 'shared/**'
---

# Shared package instructions (`@piquet-h/shared`)

These rules apply to anything under `shared/`.

## Scope & boundaries

- `shared/` is the **published** domain/core package consumed by backend, frontend, and tooling.
- Keep it **pure** and portable:
    - ✅ allowed: domain types, schemas, constants/enums, pure utilities
    - ❌ forbidden: Azure SDK usage, Functions bindings, persistence implementations, direct secret access, `process.env` access

Authoritative boundary rules live in `shared/README.md`.

## Versioning & cross-package workflow

- If you change public exports or behavior consumed by other packages:
    - bump `shared/package.json`
    - add/update tests
- Do **not** update backend/frontend to consume unpublished shared changes in the same PR unless it’s explicitly confirmed to be safe.

## Dependency safety

- Backend/frontend must depend on `@piquet-h/shared` via the registry (never `file:` references).

## Formatting & Code Style

Prettier is the authoritative formatter. If any prettier errors appear:

```bash
# Auto-fix all prettier formatting errors
npm run format:shared  # from repo root
# OR
npm run format        # from shared/ directory
```

Do NOT manually edit to fix "Delete", "Add", or spacing errors—prettier handles these automatically. After running format, stage and commit the changes.

## Verification gate (CI must be green)

For any change under `shared/`, you MUST ensure these checks pass before considering work "done":

- Format: `npm run format:check:shared` (repo root) OR `npm run format:check` (in `shared/`) – must have no prettier errors
- Lint: `npm run lint:shared` (repo root) OR `npm run lint` (in `shared/`)
- Typecheck: `npm run typecheck:shared` (repo root) OR `npm run typecheck` (in `shared/`)

If CI fails for format/lint/typecheck/tests, you MUST push follow-up commits until required checks are green.

## Cross-Package Changes (GitHub.com Agent Constraint)

**CRITICAL for agents working from GitHub.com:**

If your task requires changes to `shared/` AND (`backend/` OR `frontend/`):

❌ **DO NOT** create a single PR with both
❌ **DO NOT** add imports from unreleased `@piquet-h/shared` versions in backend/frontend
❌ **DO NOT** use `"@piquet-h/shared": "file:../shared"` in package.json

✅ **DO** create an issue describing the need
✅ **DO** respond to user that this requires local coordination (multi-stage PR)

**Why this constraint exists:**

- Shared package publishes to GitHub Packages registry when merged to main
- Backend/frontend can only import from published versions
- GitHub.com agents cannot execute sequential "merge shared → wait for publish → merge consumer" workflow

**Example response when blocked:**

```
This task requires updating both shared/ and backend/. From GitHub.com, I cannot execute the required sequential PR workflow (shared must publish to registry before backend can consume it).

Created issue #XXX to track this. A maintainer with local access can complete this via:
1. PR 1: Update shared/ + version bump → merge → publish
2. PR 2: Update backend/ to consume new shared version
```

---

Last reviewed: 2026-02-13
